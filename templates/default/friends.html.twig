{% extends 'base.html.twig' %}

{% block title %}Hello DefaultController!{% endblock %}

{% block body %}
    </head>
    <body>
    <div class="sidenav">
        <div class="d-flex justify-content-center">
            <div class="profile-picture"></div>
        </div>

        <div class="d-flex justify-content-center">
            <div class="profile-name">{{ user.username }}</div>
        </div>
        <div class="d-flex">
            <div class="nav-not-highlight"></div>
            <a class="d-flex" href="{{ path('dashboard') }}"><img class="nav-icon home-icon"
                                                                  src="{{ asset('build/images/home.png') }}" alt="">Dashboard</a>
        </div>
        <div class="d-flex">
            <div class="nav-not-highlight"></div>
            <a href="#Statistics"><img class="nav-icon" src="{{ asset('build/images/stats.png') }}"
                                       alt="">Statistics</a>
        </div>
        <div class="d-flex">
            <div class="nav-highlight"></div>
            <a href="{{ path('friends') }}" class="active notification-container"><img class="nav-icon"
                                                                                       src="{{ asset('build/images/friends.png') }}"
                                                                                       alt="">Friends</a>
        </div>
        <div class="d-flex">
            <div class="nav-not-highlight"></div>
            <a href="#Settings"><img class="nav-icon" src="{{ asset('build/images/settings.png') }}" alt="">Settings</a>
        </div>

    </div>
    <div class="d-flex justify-content-between top">
        <h2>Dashboard</h2>
        <h1 class="title">4TheCuber.<span class="title-span">net</span></h1>
    </div>
    <div class="main">

            <div class="messages"></div>

        <div class="friends-main-container d-flex">

            <div class="friends-left"></div>
            <div class="friends-middle"></div>
            <div class="friends-right">
                    <button type="button" class="friends-right-top d-flex justify-content-center btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
                        Add friends
                    </button>
                <div class="friends-right-bottom">
                    <div class="dropdown">
                        <button class="dropdown-toggle friend-dropdown" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Friend requests
                        </button>
                        <div class="dropdown-menu friend-dropdown-menu" aria-labelledby="dropdownMenuButton">
                            {% if allRequestSenders|length > 0 %}
                                {% for friend in allRequestSenders %}
                                    <div class="d-flex dropdown-friends " id="{{ friend.id }}">
                                        <div>
                                            <img class="dropdown-friend-avatar" src="{{ asset('build/images/friends-blue.png') }}" alt="">
                                        </div>
                                        <div class="{{ friend.id }}">
                                            <p class="friend-dropdown-name">{{ friend.username }}</p>

                                            <div>
                                                <button value ="{{ friend.id }}" class="btn request-button accept-request-button">accept</button>
                                                <button value ="{{ friend.id }}" class="btn request-button reject-request-button">delete</button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% else %}
                                    <div class="d-flex dropdown-friends">
                                        <div class="">
                                            <p class="friend-dropdown-name">you have no friend requests</p>
                                        </div>
                                    </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="my-modal modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content add-friend-content">
                <button type="button" class="close add-friend-x-button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="modal-header d-flex justify-content-center">
                    <h3>Add friends</h3>
                </div>
                <div class="modal-body ">
                    <h3 class="error-user"></h3>
                    <input class="add-friend-input"type="text">
                    <button type="button" class="btn btn-primary add-friend-button">Add friend</button>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button type="button" class="btn btn-secondary add-friend-close-button" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    </body>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>

        $(document).ready(function () {
            let requestType;
            let clicked = false;
            $('.request-button').one("click", function () {
                let senderId = $(this).val()
                if($(this).html() === 'accept'){
                    requestType = 'accepted';
                    clicked = true;
                    sendAnswer(requestType, senderId);
                    $("#"+senderId).remove();

                } else if ($(this).html() === 'delete'){
                    requestType = 'delete';
                    clicked = true;
                    sendAnswer(requestType, senderId);
                    $("#"+senderId).remove();
                }
                function sendAnswer(requestType, senderId){
                    $.ajax({
                        type: "POST",
                        url: 'send-friend-answer',
                        dataType: "json",
                        data: {
                            requestType: requestType,
                            senderId: senderId,
                        },
                        success: function (response) {
                            if(response.status === "success") {
                                $('.messages').addClass('friend-added-successfully');
                                $('.messages').html(response.message);

                                setTimeout(function () {
                                    $('.messages').fadeTo(1000, 0.01, function(){
                                        $(this).slideUp(150, function() {
                                            $(this).remove();
                                        });
                                    });
                                },3000)
                            } else if(response.status === "error") {
                                $('.messages').addClass('friend-deleted-successfully');
                                $('.messages').html(response.message);

                                setTimeout(function () {
                                    $('.messages').fadeTo(1000, 0.01, function(){
                                        $(this).slideUp(150, function() {
                                            $(this).remove();
                                        });
                                    });
                                },3000)
                            }
                        }
                    });
                }

            })
        });
    </script>
{% endblock %}
